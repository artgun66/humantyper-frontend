<!DOCTYPE html>
<html>
<head>
  <title>Human Typer</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
</head>
<body>
  <h2>Human Typer - Updated v2.0</h2>

  <!-- Login Section -->
  <div id="login-section">
    <button id="loginBtn">Login with Google</button>
    <p id="loginStatus">Checking login...</p>
  </div>

  <hr>

  <!-- Doc Form -->
  <div id="doc-section" style="display:none;">
    <label for="docId">Doc ID (leave blank to create new):</label><br>
    <input type="text" id="docId" placeholder="Enter Google Doc ID"><br><br>

    <textarea id="text" placeholder="Type your text here" rows="10" cols="50"></textarea><br><br>

    <button id="sendBtn">Send to Doc</button>
    <pre id="result"></pre>
  </div>

  <script>
    console.log("üöÄ Human Typer v2.0 - Debug version loaded!");
    const backend = "https://humantyper.onrender.com";

    // Function to check login status and update UI
    async function checkLogin() {
      try {
        console.log("Checking login status...");
        const res = await fetch(`${backend}/me`, { 
          credentials: "include",
          mode: "cors"
        });
        console.log("Login check response:", res.status);
        const data = await res.json();
        console.log("Login check data:", data);
        const status = document.getElementById("loginStatus");
        if (data.loggedIn) {
          status.textContent = "‚úÖ Logged in!";
          document.getElementById("doc-section").style.display = "block";
          document.getElementById("login-section").style.display = "none";
        } else {
          status.textContent = "‚ùå Not logged in";
          document.getElementById("doc-section").style.display = "none";
          document.getElementById("login-section").style.display = "block";
        }
      } catch (err) {
        console.error("Login check error:", err);
        document.getElementById("loginStatus").textContent = "‚ùå Error checking login status: " + err.message;
      }
    }

    // Call checkLogin on page load
    window.addEventListener("DOMContentLoaded", () => {
      checkLogin();
    });

    // Login button
    document.getElementById("loginBtn").addEventListener("click", () => {
      window.location.href = `${backend}/auth/google`;
    });

    // Send text button
    document.getElementById("sendBtn").addEventListener("click", async () => {
      const text = document.getElementById("text").value;
      const docId = document.getElementById("docId").value;

      if (!text.trim()) {
        document.getElementById("result").textContent = "‚ùå Please enter some text";
        return;
      }

      try {
        const res = await fetch(`${backend}/type-doc`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({ docId: docId || undefined, title: "My Doc", text })
        });

        const data = await res.json();
        const result = document.getElementById("result");

        if (data.error) {
          result.textContent = "‚ùå " + data.error;
        } else {
          result.textContent = "‚úÖ Finished typing! Doc ID: " + data.message;
        }
      } catch (err) {
        document.getElementById("result").textContent = "‚ùå Error sending request: " + err.message;
      }
    });
  </script>
</body>
</html>
